# Лабораторная работа: Разработка веб-приложений на языке Rust

**Дисциплина:** Современные технологии программирования

**Тема:** Разработка серверных веб-приложений на языке Rust с использованием фреймворка Rocket и интеграцией с нейросетевыми API.

## 1. Цель работы

Целью настоящей лабораторной работы является приобретение практических навыков в области разработки серверных приложений на языке системного программирования Rust. В ходе выполнения работы студенты должны:

-   Ознакомиться с основами языка Rust и его экосистемой.
-   Изучить принципы построения веб-приложений с использованием фреймворка Rocket.
-   Освоить методику интеграции сторонних API на примере GigaChat API.
-   Научиться применять современные паттерны проектирования для создания поддерживаемого и расширяемого кода.
-   Получить опыт коллективной разработки программного продукта.

## 2. Теоретические сведения

### 2.1. Язык программирования Rust

Rust представляет собой мультипарадигмальный компилируемый язык программирования общего назначения, разработанный Mozilla Research. Основной акцент при его создании был сделан на **безопасность**, **скорость** и **параллелизм**. Ключевой особенностью языка является система владения (ownership) с набором правил, проверяемых компилятором. Данная система позволяет управлять памятью без использования сборщика мусора, что гарантирует безопасность доступа к памяти (отсутствие гонок данных, висячих указателей и т.п.) на этапе компиляции.

### 2.2. Веб-фреймворк Rocket

Rocket — это веб-фреймворк для языка Rust, который упрощает написание быстрых и безопасных веб-приложений. Его основные преимущества:

-   **Простота использования:** интуитивно понятный синтаксис с использованием макросов для декларативного описания маршрутов.
-   **Типобезопасность:** использование системы типов Rust для проверки корректности запросов и ответов на этапе компиляции.
-   **Расширяемость:** поддержка промежуточного ПО (middleware), шаблонизаторов и управления состоянием.

### 2.3. GigaChat API

GigaChat API — это интерфейс для взаимодействия с нейросетевой моделью GigaChat, разработанной ПАО «Сбербанк». Он позволяет встраивать возможности генерации текста, ответов на вопросы и ведения диалога в сторонние приложения.

## 3. Порядок выполнения работы

### 3.1. Этап 1: Анализ демонстрационного проекта

Каждой группе студентов предоставляется демонстрационный проект `rust-gigachat-demo`, который служит основой для выполнения лабораторной работы. Необходимо выполнить следующие действия:

1.  **Ознакомиться со структурой проекта:** изучить назначение каждого каталога и файла.
2.  **Изучить исходный код:** проанализировать реализацию каждого модуля (`config`, `models`, `services`, `handlers`). Особое внимание уделить комментариям в коде — они содержат подробные объяснения для студентов.
3.  **Скомпилировать и запустить проект:** выполнить инструкции из файла `README.md`.
4.  **Протестировать API:** использовать `curl`, `HTTPie` или PowerShell для отправки запросов:

    **Через curl:**
    ```bash
    # Проверка здоровья сервера
    curl http://localhost:8000/health
    
    # Вопрос к AI (mock-ответы на английском для корректного отображения)
    curl -X POST http://localhost:8000/ask \
      -H "Content-Type: application/json" \
      -d '{"question": "What is Rust?"}'
    ```
    
    **Через HTTPie (рекомендуется - более удобный синтаксис):**
    ```bash
    # Проверка здоровья
    http GET localhost:8000/health
    
    # Вопрос к AI
    http POST localhost:8000/ask question="What is Rust?"
    ```
    
    **Установка HTTPie:**
    - Windows: `choco install httpie`
    - macOS: `brew install httpie`
    - Linux (Debian/Ubuntu): `sudo apt install httpie`
    - Linux (Fedora/RHEL): `sudo dnf install httpie`
    
    **Через PowerShell:**
    ```powershell
    Invoke-RestMethod -Uri "http://localhost:8000/health"
    
    $body = '{"question": "What is Rust?"}'
    Invoke-RestMethod -Uri "http://localhost:8000/ask" -Method POST -Body $body -ContentType "application/json"
    ```

5.  **Запустить проект в режиме заглушки (Mock Mode):** приложение автоматически переключается на mock-сервис, если не установлена переменная `GIGACHAT_TOKEN`. Mock-сервис предоставляет информативные ответы по темам: Rust, Rocket, async, testing, error handling, REST API.
6.  **При использовании web-интерфейса обеспечить CORS:** если UI запущен на другом порту, браузер блокирует запросы к API без CORS-заголовков и обработки preflight. Рекомендуемое решение описано в документе `docs/cors_for_webapp.md`.

### 3.2. Этап 2: Выбор и утверждение темы проекта

Студентам предлагается разбиться на группы по 3-4 человека. Каждая группа должна выбрать одну из предложенных тем для реализации собственного проекта на основе демонстрационного. Выбранная тема утверждается преподавателем.

**Темы проектов:**

1.  **«Умный конспектор»:** веб-сервис, который принимает на вход большой текст (например, статью) и возвращает его краткое содержание (конспект) и список ключевых терминов.
2.  **«Генератор кода для начинающих»:** сервис, который по описанию на естественном языке (например, «создай функцию на Rust, которая складывает два числа») генерирует соответствующий фрагмент кода с комментариями.
3.  **«Интерактивный помощник по информатике»:** чат-бот, способный отвечать на вопросы студентов по определенной теме курса информатики (например, «объясни, что такое рекурсия»).
4.  **«Переводчик технической документации»:** сервис для перевода англоязычных технических текстов на русский язык с сохранением форматирования и корректной передачей терминологии.
5.  **«Анализатор кода и советчик по стилю»:** сервис, который принимает фрагмент кода и с помощью GigaChat анализирует его, предлагая улучшения по стилю, читаемости и возможным ошибкам.

### 3.3. Этап 3: Проектирование и реализация

На данном этапе группа должна:

1.  **Спроектировать архитектуру** своего приложения на основе демонстрационного проекта.
2.  **Определить модели данных** (структуры запросов и ответов) для своего API.
3.  **Реализовать обработчики** для новых эндпоинтов.
4.  **Модифицировать или расширить сервисный слой** для реализации бизнес-логики проекта.
5.  **Обеспечить подробное документирование** кода с использованием `rustdoc`.

### 3.4. Этап 4: Тестирование и отладка

Необходимо разработать набор интеграционных тестов для проверки корректности работы реализованного API. Тестирование должно охватывать как успешные сценарии, так и обработку ошибок (неверные данные, пустые запросы и т.д.).

### 3.5. Этап 5: Подготовка отчета и защита работы

По итогам выполнения работы каждая группа готовит отчет, который должен содержать:

-   Титульный лист.
-   Цель работы.
-   Описание выбранной темы и спроектированной архитектуры.
-   Листинги ключевых фрагментов исходного кода с пояснениями.
-   Результаты тестирования.
-   Выводы по работе.

Защита лабораторной работы проводится в форме демонстрации работающего приложения и ответов на вопросы преподавателя.

### 3.1.1. Примеры ответов Mock-сервиса

При работе в режиме заглушки приложение возвращает информативные ответы по следующим темам:

| Вопрос (на английском) | Тема ответа |
|------------------------|-------------|
| `"What is Rust?"` | Описание языка Rust, его особенностей |
| `"Tell me about Rocket"` | Веб-фреймворк Rocket и его возможности |
| `"How to test code?"` | Тестирование в Rust (unit, integration, doc tests) |
| `"How to handle errors?"` | Обработка ошибок (Result, Option, thiserror) |
| `"What is REST API?"` | REST API и HTTP методы |
| `"What is JSON serialization?"` | Serde и работа с JSON |
| `"Tell me about async"` | Асинхронное программирование (async/await, Tokio) |
| `"How does this work?"` | Архитектура данного приложения |
| `"Hello"` | Приветствие и список доступных тем |

**Примечание:** Mock-ответы на английском языке для корректного отображения в различных терминалах.

## 4. Контрольные вопросы

1.  Каковы ключевые особенности языка Rust?
2.  Что такое «система владения» (ownership) и для чего она нужна?
3.  Назовите основные компоненты архитектуры демонстрационного проекта.
4.  Как в Rocket осуществляется маршрутизация запросов?
5.  Для чего используется трейт `AiService` в демонстрационном проекте?
6.  Как осуществляется управление конфигурацией в приложении?
7.  В чем разница между `GigaChatService` и `MockAiService`?
8.  Как добавить новый эндпоинт в приложение на Rocket?

## 5. Список рекомендуемой литературы

1.  Клэбник С., Николс К. Язык программирования Rust. — М.: ДМК Пресс, 2023.
2.  Официальная документация языка Rust: [https://doc.rust-lang.org/book/](https://doc.rust-lang.org/book/)
3.  Официальное руководство по фреймворку Rocket: [https://rocket.rs/guide/](https://rocket.rs/guide/)

## 6. Дополнительные материалы по Git и GitHub

Для подключения локального репозитория к GitHub через SSH и работы с удаленными репозиториями используйте отдельный практический гайд:

- `lab_materials/git_github_setup.md`
  - включает объяснение, почему пароль может запрашиваться при каждом запуске терминала,
    и как настроить «постоянный» `ssh-agent` для WSL.
